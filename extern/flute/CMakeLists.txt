cmake_minimum_required(VERSION 3.1)

project(FLUTE LANGUAGES CXX)

set(CMAKE_C_COMPILER "g++")
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

set(FLUTE_HOME ${CMAKE_CURRENT_SOURCE_DIR})
set(FLUTE_SRC flute.cpp)

set(POWV9_DAT ${FLUTE_HOME}/POWV9.dat)
set(POST9_DAT ${FLUTE_HOME}/POST9.dat)
set(POWV9_CPP ${FLUTE_HOME}/POWV9.cpp)
set(POST9_CPP ${FLUTE_HOME}/POST9.cpp)

add_custom_command(OUTPUT ${POWV9_CPP}
  COMMAND ${FLUTE_HOME}/MakeDatVar.tcl powv9 ${POWV9_CPP} ${POWV9_DAT}
  DEPENDS ${POWV9_DAT} ${FLUTE_HOME}/MakeDatVar.tcl
)

add_custom_command(OUTPUT ${POST9_CPP}
  COMMAND ${FLUTE_HOME}/MakeDatVar.tcl post9 ${POST9_CPP} ${POST9_DAT}
  DEPENDS ${POST9_DAT} ${FLUTE_HOME}/MakeDatVar.tcl
)

add_library(${PROJECT_NAME} 
	STATIC
	${FLUTE_SRC}
	${POWV9_CPP}
	${POST9_CPP}
)

set_target_properties(${PROJECT_NAME}
  PROPERTIES
	ARCHIVE_OUTPUT_DIRECTORY ${FLUTE_HOME}/lib
	LIBRARY_OUTPUT_DIRECTORY ${FLUTE_HOME}/lib
	RUNTIME_OUTPUT_DIRECTORY ${FLUTE_HOME}/lib
)

target_include_directories(${PROJECT_NAME} PUBLIC ${CMAKE_CURRENT_SOURCE_DIR})

# Install 
install(TARGETS ${PROJECT_NAME} DESTINATION lib)
